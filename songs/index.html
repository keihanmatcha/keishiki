<!DOCTYPE html>
<html lang="ja">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>æ›²ãƒªã‚¹ãƒˆï¼ˆvideos.json å‚ç…§ / ã‚µã‚¤ãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‹ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆï¼‹ã‚¿ã‚°è¤‡æ•°ãƒ•ã‚£ãƒ«ã‚¿ï¼‰</title>
<link rel="icon" href="/images/favicon.ico" sizes="any">
<link rel="icon" type="image/png" href="/images/Nagao-icon.png" sizes="512x512">
<link rel="apple-touch-icon" href="/images/Nagao-icon.png">
<link rel="canonical" href="https://oukasui.com/songs/">

<meta property="og:site_name" content="æ¡œè¯æ°´ï½œé•·å°¾æ™¯éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã€€æ›²æ¤œç´¢">
<meta property="og:type" content="website">
<meta property="og:title" content="æ›²æ¤œç´¢ | æ¡œè¯æ°´">
<meta property="og:description" content="é•·å°¾æ™¯ã®æ›²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãƒ»ã‚¿ã‚°ã§æ¤œç´¢ã§ãã¾ã™ã€‚">
<meta property="og:url" content="https://oukasui.com/song/">
<meta property="og:image" content="https://oukasui.com/images/ogp.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="æ›²æ¤œç´¢ | æ¡œè¯æ°´">
<meta name="twitter:description" content="é•·å°¾æ™¯ã®æ›²ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãƒ»ã‚¿ã‚°ã§æ¤œç´¢ã§ãã¾ã™ã€‚">
<meta name="twitter:image" content="https://oukasui.com/images/ogp.png">

Â  <style>
Â  Â  :root{ --fg:#222; --muted:#6b7280; --accent:#625DA1; --bg:#fff; --border:#e5e7eb; --panel:#f8f8ff; }
Â  Â  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif}

Â  Â  header{position:sticky;top:0;background:#fffcc;backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid var(--border)}
Â  Â  .wrap{max-width:1200px;margin-inline:auto;padding:14px 16px}
Â  Â  h1{margin:0 0 8px;font-size:20px}
Â  Â  .toolbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
Â  Â  .searchbar{display:flex;gap:10px;align-items:center;flex:1}
Â  Â  .searchbar input{flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font-size:16px}

Â  Â  /* ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰ */
Â  Â  .filterbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
Â  Â  .filterbar .label{font-size:12px;color:var(--muted)}
Â  Â  .filter-tags{display:flex;gap:8px;flex-wrap:wrap}
Â  Â  .chip-tag{font-size:12px;line-height:1;padding:8px 12px;border:1px solid #e5dfff;border-radius:999px;background:#f0ecff;color:#5b55a5;cursor:pointer}
Â  Â  .chip-tag:hover{filter:brightness(0.97)}
Â  Â  .chip-tag.active{background:var(--accent);border-color:var(--accent);color:#fff}
Â  Â  .chip-clear{font-size:12px;padding:6px 10px;border:1px dashed var(--border);border-radius:999px;background:#fff;color:#6b7280;cursor:pointer}
Â  Â  .chip-clear:hover{border-color:#c1c5e8;color:#4b5563}

Â  Â  /* 2ã‚«ãƒ©ãƒ  */
Â  Â  .grid{display:grid;gap:16px;align-items:start;grid-template-columns:1.2fr .8fr;grid-template-areas:"list player"}
Â  Â  .grid.player-left{grid-template-columns:.8fr 1.2fr;grid-template-areas:"player list"}
Â  Â  @media (max-width: 900px){ .grid{grid-template-columns:1fr;grid-template-areas:"player" "list"} }

Â  Â  /* è¡Œãƒªã‚¹ãƒˆ */
Â  Â  .list{border:1px solid var(--border);border-radius:14px;overflow:hidden}
Â  Â  .row{display:grid;grid-template-columns:minmax(260px,1.5fr) 120px minmax(0,2fr);align-items:center;gap:12px;padding:10px 14px;border-top:1px solid var(--border);background:#fafafa}
Â  Â  .row:nth-child(odd){background:#f6f6fb}
Â  Â  .row:first-child{border-top:none}
Â  Â  .songcell{display:flex;flex-direction:column}
Â  Â  .songtitle{font-weight:600;display:flex;gap:8px;align-items:center}
Â  Â  .songtitle .note{font-size:18px}
Â  Â  .artist{font-size:12px;color:var(--muted)}
Â  Â  .link{all:unset; cursor:pointer; color:inherit}
Â  Â  .link:hover{color:var(--accent); text-decoration:underline}
Â  Â  .link.artist{color:var(--muted)}
Â  Â  .date{font-variant-numeric:tabular-nums;font-feature-settings:"tnum" 1;color:#374151;justify-self:end;text-align:right;width:120px}
Â  Â  .videotitle{display:flex;flex-direction:column;gap:6px}
Â  Â  .videotitle button{all:unset;cursor:pointer;color:#111}
Â  Â  .videotitle button:hover{color:var(--accent);text-decoration:underline}
Â  Â  .ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
Â  Â  .tags-row{display:flex;gap:6px;flex-wrap:wrap}
Â  Â  .tag{font-size:11px;line-height:1;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;color:#374151;cursor:pointer}
Â  Â  .tag:hover{border-color:var(--accent);color:var(--accent)}
Â  Â  /* å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ãƒ–ãƒ­ãƒƒã‚¯ï¼šã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¿ã‚°ã®è·é›¢ã‚’ç©ºã‘ã‚‹ */
.videotitle{
Â  display:flex; flex-direction:column; gap:8px;
}

/* ã‚¿ã‚°è¡Œã‚’â€œè¡Œâ€ã¨ã—ã¦æ˜ç¢ºåŒ–ï¼ˆå·¦ã«è–„ã„ãƒ©ãƒ™ãƒ«ã€è¡Œå…¨ä½“ã®ä½™ç™½ï¼‰ */
.tags-row{
Â  display:flex; flex-wrap:wrap; gap:8px;
Â  align-items:center;
Â  margin-top:2px;
Â  padding-top:6px;
Â  border-top:1px dashed var(--border);
}

/* ã‚¿ã‚°è¡Œã®ãƒ©ãƒ™ãƒ«ï¼ˆè£…é£¾ï¼‰ã€‚å¿…è¦ãªã‘ã‚Œã°ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆå¯ */
.tags-row::before{
Â  content:"ã‚¿ã‚°";
Â  font-size:11px; color:var(--muted);
Â  margin-right:4px; padding:2px 6px;
Â  border:1px solid var(--border);
Â  border-radius:999px; background:#fff;
}

/* ã‚¿ã‚°ã®â€œãƒ”ãƒ«â€ã‚¹ã‚¿ã‚¤ãƒ« */
.tag-badge{
Â  appearance:none; border:0; cursor:pointer;
Â  font-size:12px; line-height:1;
Â  padding:8px 12px; border-radius:999px;
Â  background:#f2efff;
Â  color:#4c46a6;
Â  border:1px solid #e5dfff;
Â  display:inline-flex; gap:6px; align-items:center;
}

/* ãƒãƒƒã‚·ãƒ¥ # ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆç–‘ä¼¼è¦ç´ ã§ä»˜ã‘ã‚‹ï¼‰ */
.tag-badge::before{
Â  content:"#";
Â  font-weight:700; opacity:.6;
}

/* ãƒ›ãƒãƒ¼ & ã‚¢ã‚¯ãƒ†ã‚£ãƒ– */
.tag-badge:hover{ filter:brightness(.97) }
.tag-badge:active{ transform: translateY(1px) }

/* â€œé¸æŠä¸­â€ã‚’å¼·ã‚ã«è¦‹ã›ãŸã„å ´åˆï¼ˆä»»æ„ã§JSã‹ã‚‰ .active ã‚’ä»˜ã‘ã‚‹æƒ³å®šï¼‰ */
.tag-badge.active{
Â  background:var(--accent);
Â  border-color:var(--accent);
Â  color:#fff;
Â  box-shadow:0 0 0 3px var(--ring);
}
    
@media (max-width: 720px){ .row{grid-template-columns:1fr;align-items:start} .date{justify-self:start} .videotitle{margin-top:-4px} }
    
.nothing{color:var(--muted);text-align:center;padding:20px;border:1px dashed var(--border);border-radius:12px}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
.player-panel{position:sticky;top:84px;border:1px solid var(--border);border-radius:14px;overflow:hidden;background:var(--panel)}
/* ä½™ç™½ã‚’è©°ã‚ãŸã„å ´åˆã¯ä¸Šã® top ã‚’èª¿æ•´ã€‚sticky ãªã®ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã¤ã„ã¦ãã¾ã™ã€‚*/
.player-head{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#f0f1ff;border-bottom:1px solid var(--border)}
.player-head .drag-handle{
    font-weight:700;
    opacity:.5;
    padding:0 6px;
    border-radius:6px;
}
.player-panel.is-float .player-head:active{
  cursor: grabbing;
}

.player-title{font-size:14px;color:#333;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.player-sub{font-size:12px;color:var(--muted)}
.player-body{position:relative;aspect-ratio:16/9;width:100%;background:#000}
.player-body iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
.player-foot{padding:10px 14px;border-top:1px solid var(--border);background:#fff}
.meta-line{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
.setlist{max-height:420px;overflow:auto;border:1px solid var(--border);border-radius:10px;margin-top:8px}
.set-item{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-top:1px solid var(--border);background:#fafafa;cursor:pointer}
.set-item:first-child{border-top:none}
.set-item:hover{background:#f3f4ff}
.set-item.active{background:#e9ecff}
.set-title{display:flex;flex-direction:column}
.set-song{font-weight:600}
.set-artist{font-size:12px;color:var(--muted)}
.set-time{font-variant-numeric:tabular-nums;color:#374151;white-space:nowrap}

.warn{margin-top:8px;padding:10px 12px;color:#92400e;background:#fff7ed;border:1px solid #fed7aa;border-radius:8px}
/* ===== ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½å¾“ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰ï¼†ãƒ¢ãƒã‚¤ãƒ«æµ®å‹•ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ===== */
/* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¿½å¾“ */
@media (min-width: 901px){
Â  /* ã‚«ãƒ©ãƒ å…¨ä½“ã‚’stickyã«ã—ã¦ã€ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã¤ã„ã¦ãã‚‹ */
Â  .player-col{ position: sticky; top: 84px; align-self:start; height: fit-content; z-index: 5; }
Â  /* å†…å´ã®ãƒ‘ãƒãƒ«ã¯é€šå¸¸ãƒ•ãƒ­ãƒ¼ã«ï¼ˆå…¥ã‚Œå­stickyã‚’é¿ã‘ã‚‹ï¼‰ */
Â  .player-panel{ position: static; }
}
/* ãƒ¢ãƒã‚¤ãƒ«ï¼šå³ä¸‹ã«å°ã•ãªå¸¸æ™‚è¡¨ç¤ºãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
@media (max-width: 900px){
Â  body.has-float{ padding-bottom: 220px; } /* ä¸‹ã‚’è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã®ä½™ç™½ */
Â  .player-panel.is-float{ position: fixed; right: 12px; bottom: 12px; width: min(88vw, 340px); z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,.25); border-radius: 14px; }
Â  @media (max-width: 900px){
.player-panel.is-float{
Â  Â  position: fixed; right: 12px; bottom: 12px;
Â  Â  width: min(92vw, 360px);
Â  Â  z-index: 1000; box-shadow: 0 12px 32px rgba(0,0,0,.28);
Â  Â  border-radius: 14px; overflow: hidden; Â  Â /* â† è¿½åŠ  */
Â  Â  background: var(--panel,#fff); Â  Â  Â  Â  Â  Â /* â† è¿½åŠ  */
Â  }
Â  /* â† ã“ã“ã‚’å¤‰æ›´ï¼šheadã¯ç¸®ã‚ã‚‹ã ã‘ã€footï¼ˆã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆï¼‰ã¯è¡¨ç¤ºã™ã‚‹ */
Â  .player-panel.is-float .player-head{
Â  Â  display:flex; align-items:center;
Â  Â  padding: 6px 10px; gap: 8px; height: 36px;
Â  Â  cursor: grab; user-select:none; Â  Â  Â  Â  Â  /* â† ãƒ‰ãƒ©ãƒƒã‚°ç”¨ */
Â  }
Â  .player-panel.is-float .player-body{ aspect-ratio: 16/9; }
Â  .player-panel.is-float .player-foot{
Â  Â  display:block; max-height: 40vh; Â  Â  Â  Â  Â /* â† ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã‚’å‡ºã™ */
Â  Â  overflow:auto; border-top: 1px solid #eee;
Â  }
Â  /* ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã®è¡Œã‚’ã‚¿ãƒƒãƒã—ã‚„ã™ã */
Â  .player-panel.is-float .setlist .item{
Â  Â  padding: 10px 12px; font-size: 14px; line-height: 1.25;
Â  }
}

Â  Â  Â  .player-panel.is-float .player-body{ aspect-ratio: 16/9; }
Â  Â  }
.list-col{grid-area:list}
Â  .player-col{grid-area:player}
/* ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.favorite-btn {
Â  /* ãƒœã‚¿ãƒ³ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆ */
Â  all: unset;
Â  cursor: pointer;
Â  padding: 0;
Â  margin-left: 8px; /* æ›²åã‹ã‚‰ã®é–“éš” */
}

.star-icon {
Â  font-size: 20px;
Â  color: #ccc; /* é€šå¸¸æ™‚ã®ç°è‰² */
Â  transition: color 0.2s ease;
}

/* ãŠæ°—ã«å…¥ã‚Šç™»éŒ²æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.favorite-btn.is-favorited .star-icon {
Â  color: #FFD700; /* ç™»éŒ²å¾Œã®é‡‘è‰² */
Â  text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

Â  </style>
</head>
<body>
Â  <header>
Â  Â  <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:20px">
Â  Â  Â  <a href="../index.html" class="brand" aria-label="HOME">
Â  Â  Â  <span style="font-weight:700;color:#4c46a6">HOME</span>
Â  Â  </a>
Â  Â  Â  <h1>ğŸµ é•·å°¾æ™¯ æ›²æ¤œç´¢</h1>
Â  Â  Â  <div class="toolbar">
Â  Â  Â  Â  <div class="searchbar"><input id="q" type="search" placeholder="æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚¿ã‚°ã§æ¤œç´¢" autocomplete="off" /></div>
Â  Â  Â  Â  <div class="filterbar">
Â  Â  Â  Â  Â  <span class="label">ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿ï¼š</span>
Â  Â  Â  Â  Â  <div id="filterTags" class="filter-tags"></div>
Â  Â  Â  Â  Â  <button id="filterFavorites" class="chip-tag" type="button" style="display:none">â˜… ãŠæ°—ã«å…¥ã‚Š</button>
Â  Â  Â  Â  Â  <button id="clearTags" class="chip-clear" type="button" style="display:none">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è§£é™¤</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  </div>
Â  Â  </div>
Â  </header>

Â  <main class="wrap">
Â  Â  <div id="grid" class="grid player-left">
Â  Â  Â  <section class="list-col">
Â  Â  Â  Â  <div id="list" class="list"></div>
Â  Â  Â  Â  <div id="empty" class="nothing" style="display:none">è©²å½“ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
Â  Â  Â  </section>
Â  Â  Â  <aside class="player-col">
Â  Â  Â  Â  <div class="player-panel" id="playerPanel" style="display:none">
Â  Â  Â  Â  Â  <div class="player-head">
Â  Â  Â  Â  Â  Â  <span class="drag-handle" aria-label="Move">â‰¡</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div class="player-title" id="playerTitle">ï¼ˆå‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ï¼‰</div>
Â  Â  Â  Â  Â  Â  Â  <div class="player-sub" id="playerMeta">YYYY.MM.DD / ãƒãƒ£ãƒ³ãƒãƒ«å</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex;gap:8px;align-items:center"><a id="openYT" href="#" target="_blank" rel="noopener" style="font-size:12px;color:var(--accent);text-decoration:none">YouTubeã§é–‹ã â†—</a></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="player-body"><iframe id="ytFrame" src="about:blank" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe></div>
Â  Â  Â  Â  Â  <div class="player-foot">
Â  Â  Â  Â  Â  Â  <div class="meta-line"><strong>ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆ</strong></div>
Â  Â  Â  Â  Â  Â  <div class="setlist" id="setlist"></div>
Â  Â  Â  Â  Â  Â  <div id="embedWarn" class="warn" style="display:none">ã“ã®å‹•ç”»ã¯ãƒšãƒ¼ã‚¸å†…å†ç”ŸãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<a id="warnLink" href="#" target="_blank" rel="noopener">YouTubeã§é–‹ã</a> ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>
Â  Â  </div>
Â  </main>

Â  <script src="https://www.youtube.com/iframe_api"></script>
Â  <script>
Â  Â  const $list = document.getElementById('list');
Â  Â  const $empty = document.getElementById('empty');
Â  Â  const $q = document.getElementById('q');
Â  Â  const $grid = document.getElementById('grid');
Â  Â  const $filterTags = document.getElementById('filterTags');
Â  Â  const $clearTags = document.getElementById('clearTags');
Â  Â  // const $clearTags = document.getElementById('clearTags'); ã®ä¸‹ã«è¿½åŠ 
Â  Â  const $filterFavorites = document.getElementById('filterFavorites');
Â  Â  let filterByFavorites = false; // ãŠæ°—ã«å…¥ã‚Šã§çµã‚Šè¾¼ã‚€ã‹ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãƒ•ãƒ©ã‚°

Â  Â  const $panel = document.getElementById('playerPanel');
Â  Â  const $yt = document.getElementById('ytFrame');
Â  Â  const $title = document.getElementById('playerTitle');
Â  Â  const $meta = document.getElementById('playerMeta');
Â  Â  const $open = document.getElementById('openYT');
Â  Â  const $warn = document.getElementById('embedWarn');
Â  Â  const $warnLink = document.getElementById('warnLink');
Â  Â  const $setlist = document.getElementById('setlist');

Â  Â  const pad = n => String(n).padStart(2,'0');
Â  Â  const ymdToDots = ymd => { const [y,m,d] = (ymd||'').split('-'); return y?`${y}.${pad(m)}.${pad(d)}`:''; };
Â  Â  const FAVORITES_KEY = 'favorites';
Â  Â  function fillSearch(text){ if(!text) return; $q.value=text; applyFilter(); }

Â  Â  function toSeconds(v){
Â  Â  Â  if(v==null) return 0;
Â  Â  Â  if (typeof v === 'number') return Math.max(0, v|0);
Â  Â  Â  if (/^\d+$/.test(v)) return Math.max(0, parseInt(v,10));
Â  Â  Â  const p = String(v).split(':').map(Number);
Â  Â  Â  if (p.length===3) return p[0]*3600 + p[1]*60 + p[2];
Â  Â  Â  if (p.length===2) return p[0]*60 + p[1];
Â  Â  Â  return 0;
Â  Â  }
Â  Â  const hms = sec => { sec=toSeconds(sec); const h=Math.floor(sec/3600), m=Math.floor(sec%3600/60), s=Math.floor(sec%60); return `${pad(h)}:${pad(m)}:${pad(s)}`; };

Â  Â  let player=null, apiReady=false;
Â  Â  window.onYouTubeIframeAPIReady = ()=>{ apiReady = true; };
Â  Â  function loadVideo(id, start=0){
Â  Â  Â  $warn.style.display='none';
Â  Â  Â  const startSec = toSeconds(start);

Â  // âœ… åŸ‹ã‚è¾¼ã¿URLã‚’ www.youtube.com/embed/ ã«çµ±ä¸€
Â  Â  Â  const url = `https://www.youtube.com/embed/${id}?start=${startSec}&autoplay=1&rel=0&modestbranding=1&playsinline=1&enablejsapi=1`;

Â  Â  Â  if(apiReady){
Â  Â  Â  Â  if(!player){
Â  Â  Â  Â  Â  player = new YT.Player('ytFrame', {
Â  Â  Â  Â  Â  Â  playerVars:{rel:0,modestbranding:1,playsinline:1},
Â  Â  Â  Â  Â  Â  events:{ onError:()=>($warn.style.display='block') }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  player.loadVideoById({videoId:id, startSeconds:startSec});
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }catch(e){}
Â  Â  Â  }
Â  Â  Â  $yt.src = url;
Â  Â  }


Â  Â  // ===== ãƒ‡ãƒ¼ã‚¿æ•´å½¢ =====
Â  Â  function normalizeVideos(videos){
Â  const map = new Map();
Â  for(const raw of videos){
Â  Â  const v = {...raw};
Â  Â  const id = v.youtubeId;

Â  Â  // å‹•ç”»ãƒ¬ãƒ™ãƒ«ã®ã‚¿ã‚°ï¼ˆé…åˆ—åŒ–ï¼‰
Â  Â  const videoTags = Array.isArray(v.tags) ? v.tags.filter(Boolean) : [];

Â  Â  // â˜… æ›²ã«ã‚‚ tags ã‚’æŒãŸã›ã‚‹ã€‚ç„¡ã‘ã‚Œã° videoTags ã‚’ç¶™æ‰¿
Â  Â  const songs = (v.songs || v.setlist || []).map(s => ({
Â  Â  Â  title:Â  s.titleÂ  || s.songÂ  Â || '',
Â  Â  Â  artist: s.artist || s.singer || 'ï¼ˆä¸æ˜ï¼‰',
Â  Â  Â  start:Â  toSeconds(s.start ?? s.time ?? s.begin ?? 0),
Â  Â  Â  tags:Â  Â Array.isArray(s.tags) ? s.tags.filter(Boolean) : videoTags
Â  Â  }));

Â  Â  if(!map.has(id)){
Â  Â  Â  map.set(id, {
Â  Â  Â  Â  title: v.title||'',
Â  Â  Â  Â  date: v.date||'',
Â  Â  Â  Â  channel: v.channel||'',
Â  Â  Â  Â  youtubeId: id||'',
Â  Â  Â  Â  songs: [],
Â  Â  Â  Â  tags: videoTags.slice() // videoãƒ¬ãƒ™ãƒ«ã®ã‚¿ã‚°ã‚‚ä¿æŒ
Â  Â  Â  });
Â  Â  }
Â  Â  const bucket = map.get(id);

Â  Â  // æ›²ã®é‡è¤‡æ’é™¤
Â  Â  for(const s of songs){
Â  Â  Â  const key = `${s.title}__${s.artist}__${s.start}`;
Â  Â  Â  if(!bucket.songs.some(t => `${t.title}__${t.artist}__${t.start}`===key)){
Â  Â  Â  Â  bucket.songs.push(s);
Â  Â  Â  }
Â  Â  }
Â  }
Â  for(const v of map.values()){ v.songs.sort((a,b)=> a.start - b.start); }
Â  return [...map.values()];
}


Â  Â  let ALL_ROWS=[]; let VIDEO_MAP=new Map(); let ALL_TAGS=[]; const SELECTED_TAGS=new Set();
Â  function buildRows(videos){
Â  const merged = normalizeVideos(videos);
Â  VIDEO_MAP = new Map(merged.map(v => [v.youtubeId, v]));
Â  ALL_ROWS = [];

Â  for(const v of merged){
Â  Â  for(const s of v.songs){
Â  Â  Â  ALL_ROWS.push({
Â  Â  Â  Â  song: s.title,
Â  Â  Â  Â  artist: s.artist,
Â  Â  Â  Â  date: v.date,
Â  Â  Â  Â  videoTitle: v.title,
Â  Â  Â  Â  youtubeId: v.youtubeId,
Â  Â  Â  Â  start: s.start,
Â  Â  Â  Â  // â˜… æ›²ã‚¿ã‚°ã‚’è¡Œã«å…¥ã‚Œã‚‹
Â  Â  Â  Â  tags: s.tags || [],
Â  Â  Â  Â  tagsText: (s.tags || []).join(' ')
Â  Â  Â  });
Â  Â  }
Â  }
// â˜… ã‚¿ã‚°ä¸€è¦§ã¯è¡Œï¼ˆæ›²ï¼‰ã‹ã‚‰ä½œã‚‹
Â  ALL_ROWS.sort((a,b)=>{
Â  Â  if(a.date!==b.date) return a.date<b.date?1:-1;
Â  Â  const s=a.song.localeCompare(b.song,'ja'); if(s) return s;
Â  Â  return a.artist.localeCompare(b.artist,'ja');
Â  });

Â  // â˜… ã‚¿ã‚°ä¸€è¦§ã¯è¡Œï¼ˆæ›²ï¼‰ã‹ã‚‰ä½œã‚‹
Â  ALL_TAGS = Array.from(new Set(ALL_ROWS.flatMap(r => r.tags || [])))
Â  Â  Â  Â  Â  Â  .sort((a,b)=>a.localeCompare(b,'ja'));

Â  renderFilterTags();
}
Â  Â  // ===== ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ UI =====
function renderFilterTags(){
Â  // â˜…ãƒœã‚¿ãƒ³ã‚’åˆ¶å¾¡
Â  const favorites = getFavorites();
Â  $filterFavorites.style.display = favorites.length > 0 ? '' : 'none';
Â  $filterFavorites.classList.toggle('active', filterByFavorites);
Â Â 
Â  // ä»–ã®ã‚¿ã‚°ã®æç”»
Â  $filterTags.innerHTML='';
Â  if(!ALL_TAGS.length && favorites.length === 0){Â 
Â  Â  Â  $filterTags.parentElement.style.display='none';Â 
Â  Â  Â  $clearTags.style.display='none';Â 
Â  Â  Â  return;Â 
Â  }
Â  $filterTags.parentElement.style.display='';
Â  for(const t of ALL_TAGS){
Â  Â  const b=document.createElement('button');
Â  Â  b.className='chip-tag'+(SELECTED_TAGS.has(t)?' active':'');
Â  Â  b.type='button'; b.textContent=t;
Â  Â  b.addEventListener('click', ()=>{Â 
Â  Â  Â  Â  filterByFavorites = false; // ã‚¿ã‚°ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãŠæ°—ã«å…¥ã‚Šçµã‚Šè¾¼ã¿ã‚’è§£é™¤
Â  Â  Â  Â  if(SELECTED_TAGS.has(t)) SELECTED_TAGS.delete(t);Â 
Â  Â  Â  Â  else SELECTED_TAGS.add(t);Â 
Â  Â  Â  Â  renderFilterTags();Â 
Â  Â  Â  Â  applyFilter();Â 
Â  Â  });
Â  Â  $filterTags.appendChild(b);
Â  }
Â Â 
Â  $clearTags.style.display = (SELECTED_TAGS.size > 0 || filterByFavorites) ? 'inline-block':'none';
}

// clearTagsã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚‚ä¿®æ­£
$clearTags.addEventListener('click', ()=>{Â 
Â  Â  SELECTED_TAGS.clear();Â 
Â  Â  filterByFavorites = false; // å…¨ã‚¯ãƒªã‚¢æ™‚ã«ãŠæ°—ã«å…¥ã‚Šã‚‚è§£é™¤
Â  Â  renderFilterTags();Â 
Â  Â  applyFilter();Â 
});

// æ–°ã—ã„ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
$filterFavorites.addEventListener('click', ()=>{
Â  Â  filterByFavorites = !filterByFavorites; // çŠ¶æ…‹ã‚’åè»¢
Â  Â  SELECTED_TAGS.clear(); // ãŠæ°—ã«å…¥ã‚Šçµã‚Šè¾¼ã¿æ™‚ã¯ä»–ã®ã‚¿ã‚°ã‚’ã‚¯ãƒªã‚¢
Â  Â  renderFilterTags();
Â  Â  applyFilter();
});
Â  Â Â 
// ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆã‚’localStorageã‹ã‚‰å–å¾—
function getFavorites() {
Â  const favorites = localStorage.getItem(FAVORITES_KEY);
Â  return favorites ? JSON.parse(favorites) : [];
}

// ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆã‚’localStorageã«ä¿å­˜
function saveFavorites(favorites) {
Â  localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
}
function renderSetlist(video, currentId, currentTime) {
Â  const $setlist = document.getElementById('setlist');
Â  $setlist.innerHTML = '';
Â  if (!video || !video.songs || video.songs.length === 0) {
Â  Â  $setlist.innerHTML = '<div style="padding:10px;text-align:center;color:#6b7280;">ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
Â  Â  return;
Â  }
Â  video.songs.forEach(song => {
Â  Â  const item = document.createElement('div');
Â  Â  item.className = 'set-item' + (song.start === currentTime ? ' active' : '');
Â  Â  item.innerHTML = `<div class="set-title"><span class="set-song">${song.title}</span><span class="set-artist">${song.artist}</span></div><div class="set-time">${hms(song.start)}</div>`;
Â  Â  item.addEventListener('click', () => {
Â  Â  Â  // playFromé–¢æ•°ã«æ­£ã—ã„å¼•æ•°ã‚’æ¸¡ã™ã‚ˆã†ã«ä¿®æ­£
Â  Â  Â  const songInfo = {
Â  Â  Â  Â  youtubeId: currentId,
Â  Â  Â  Â  start: song.start,
Â  Â  Â  Â  videoTitle: video.title,
Â  Â  Â  Â  date: video.date
Â  Â  Â  };
Â  Â  Â  playFrom(songInfo);
Â  Â  });
Â  Â  $setlist.appendChild(item);
Â  });
}
Â Â 
// ===== ãƒªã‚¹ãƒˆæç”» =====

function renderRows(rows){
Â  $list.innerHTML='';
Â  if(!rows.length){ $empty.style.display='block'; return; }
Â  $empty.style.display='none';

Â  // è¡Œãƒ‡ãƒ¼ã‚¿ r ã‹ã‚‰ã€Œãƒ‘ãƒãƒ«æ›´æ–°ï¼‹å†ç”Ÿã€ã‚’å®Ÿè¡Œã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
Â  function playFrom(r){
Â  Â  const id = r.youtubeId;
Â  Â  const start = toSeconds(r.start);
Â  Â  const video = VIDEO_MAP.get(id) || { songs:[], tags:[], channel:'', title:r.videoTitle };

Â  Â  // å†ç”Ÿãƒ‘ãƒãƒ«ã®æ›´æ–°
Â  Â  $title.textContent = `${r.videoTitle}${start ? `ï¼ˆ${hms(start)}ã€œï¼‰` : ''}`;
Â  Â  $meta.textContent = `${ymdToDots(r.date)} / ${video.channel || ''}`;
Â  Â  const openUrl = `https://www.youtube.com/watch?v=${id}&t=${start||0}s`;
Â  Â  $open.href = openUrl;
Â  Â  $warnLink.href = openUrl;

Â  Â  // ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆæç”»ï¼†å†ç”Ÿ
Â  Â  renderSetlist(video, id, start||0);
Â  Â  loadVideo(id, start||0);

Â  Â  // ãƒ‘ãƒãƒ«è¡¨ç¤ºã¨è¿½å¾“UI
Â  Â  $panel.style.display='block';
Â  Â  updateFloatOnPlay();
Â  Â  $panel.scrollIntoView({behavior:'smooth', block:'nearest'});
Â  }

Â  for(const r of rows){
Â  Â  const div = document.createElement('div');
Â  Â  div.className = 'row';

Â  Â  div.innerHTML = `
Â  Â  Â  <div class="songcell" data-song-key="${r.youtubeId}-${r.start}">
Â  Â  Â  Â  <div class="songtitle ellipsis">
Â  Â  Â  Â  Â  <span class="note">ğŸµ</span>
Â  Â  Â  Â  Â  <span class="song link">${r.song}</span>
Â  Â  Â  Â  Â  <button class="favorite-btn" aria-label="ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ /å‰Šé™¤">
Â  Â  Â  Â  Â  Â  <span class="star-icon">â˜†</span>
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="artist ellipsis"><span class="artist link">${r.artist||''}</span></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="date">${ymdToDots(r.date)}</div>
Â  Â  Â  <div class="videotitle">
Â  Â  Â  Â  Â  <div class="ellipsis">
Â  Â  Â  Â  Â  Â  <button type="button" class="videolink" data-id="${r.youtubeId}" data-start="${r.start||''}">
Â  Â  Â  Â  Â  Â  Â  ${r.videoTitle}
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="tags-row"></div>
Â  Â  Â  Â  </div>`;
Â  Â Â 
Â  Â  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®šã‚’ã“ã“ã§è¡Œã†
Â  Â  const favBtn = div.querySelector('.favorite-btn');
Â  Â  const songKey = div.querySelector('.songcell').dataset.songKey;

Â  Â  if (getFavorites().includes(songKey)) {
Â  Â  Â  favBtn.classList.add('is-favorited');
Â  Â  }

Â  Â  favBtn.addEventListener('click', (e) => {
Â  Â  Â  e.stopPropagation();
Â  Â  Â  const currentFavorites = getFavorites();
Â  Â  Â  const index = currentFavorites.indexOf(songKey);
Â  Â  Â Â 
Â  Â  Â  if (index > -1) {
Â  Â  Â  Â  currentFavorites.splice(index, 1);
Â  Â  Â  Â  favBtn.classList.remove('is-favorited');
Â  Â  Â  } else {
Â  Â  Â  Â  currentFavorites.push(songKey);
Â  Â  Â  Â  favBtn.classList.add('is-favorited');
Â  Â  Â  }
Â  Â  Â  saveFavorites(currentFavorites);
Â  Â  });

Â  Â  const songEl = div.querySelector('.song');
Â  Â  const artistEl = div.querySelector('.artist');
Â  Â  songEl.addEventListener('click', (e)=>{ e.stopPropagation(); fillSearch(r.song); });
Â  Â  artistEl.addEventListener('click', (e)=>{ e.stopPropagation(); if(r.artist) fillSearch(r.artist); });

Â  Â  const rowTagBox = div.querySelector('.tags-row');
Â  Â  const tags = (r.tags && r.tags.length) ? r.tags : (VIDEO_MAP.get(r.youtubeId)?.tags || []);
Â  Â  tags.forEach(t=>{
Â  Â  Â  const b = document.createElement('button');
Â  Â  Â  b.className = 'tag-badge';
Â  Â  Â  b.type = 'button';
Â  Â  Â  b.textContent = t;
Â  Â  Â  b.addEventListener('click', (e)=>{ e.stopPropagation(); fillSearch(t); });
Â  Â  Â  rowTagBox.appendChild(b);
Â  Â  });

Â  Â  const vtBtn = div.querySelector('.videotitle .videolink');
Â  Â  vtBtn.addEventListener('click', (e)=>{ e.stopPropagation(); playFrom(r); });
Â  Â  vtBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); playFrom(r); }});

Â  Â  const onRowPlay = (e)=>{
Â  Â  Â  if (e.target.closest('.song')) return;
Â  Â  Â  if (e.target.closest('.artist')) return;
Â  Â  Â  if (e.target.closest('.tag-badge')) return;
Â  Â  Â  playFrom(r);
Â  Â  };
Â  Â  div.addEventListener('click', onRowPlay);
Â  Â  div.tabIndex = 0;
Â  Â  div.setAttribute('role','button');
Â  Â  div.setAttribute('aria-label', `${r.song} / ${r.artist||''} ã‚’å†ç”Ÿ`);
Â  Â  div.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onRowPlay(e); }});

Â  Â  $list.appendChild(div);
Â  }
}
Â  Â  // ===== ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆæ¤œç´¢ãƒ†ã‚­ã‚¹ãƒˆï¼‹ã‚¿ã‚° ANDï¼‰ =====
function applyFilter(){
Â  Â  let filteredRows;
Â  Â Â 
Â  Â  if (filterByFavorites) {
Â  Â  Â  const favorites = getFavorites();
Â  Â  Â  filteredRows = ALL_ROWS.filter(r => favorites.includes(`${r.youtubeId}-${r.start}`));
Â  Â  } else {
Â  Â  Â  // æ—¢å­˜ã®çµã‚Šè¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯
Â  Â  Â  const q=($q.value||'').trim().toLowerCase();
Â  Â  Â  const selected=[...SELECTED_TAGS];
Â  Â  Â  filteredRows = ALL_ROWS.filter(r=>{
Â  Â  Â  Â  const textOk = !q || r.song.toLowerCase().includes(q) || r.artist.toLowerCase().includes(q) || r.videoTitle.toLowerCase().includes(q) || (r.tagsText||'').toLowerCase().includes(q);
Â  Â  Â  Â  const tagOk = !selected.length || selected.some(t => (r.tags||[]).includes(t));
Â  Â  Â  Â  return textOk && tagOk;
Â  Â  Â  });
Â  Â  }
Â  Â  renderRows(filteredRows);
}
Â  Â  fetch('videos.json')
Â  Â  Â  .then(r => r.json())
Â  Â  Â  .then(videos => {
Â  Â  // å‹•ç”»ã‚¿ã‚°ã®ç¶™æ‰¿ã¨å…¨è§’ã‚«ãƒƒã‚³ã®ä¿®æ­£ï¼ˆã“ã®éƒ¨åˆ†ã¯ãã®ã¾ã¾ï¼‰
Â  Â  Â  Â const videosWithSongTags = videos.map(v => ({
Â  Â  Â  Â  ...v,
Â  Â  Â  Â songs: (v.songs || []).map(s => ({
Â  Â  Â  Â  Â ...s,
Â  Â  Â  Â  tags: Array.isArray(s.tags) ? s.tags
Â  Â  Â  Â  Â  Â  Â : (Array.isArray(v.tags) ? v.tags : [])
Â  Â  Â  Â }))
Â  Â  Â  }));

Â  Â  videosWithSongTags.forEach(v =>
Â  Â  Â  (v.songs||[]).forEach(s => {
Â  Â  Â  Â  s.tags = (s.tags||[]).map(t => t.replace(/ï¼ˆ/g,'(').replace(/ï¼‰/g,')'));
Â  Â  Â  })
Â  Â  );

Â  Â  // æ”¹å–„ç‚¹ï¼šALL_ROWSã®ä½œæˆã¨æç”»ã‚’1ã¤ã®å‡¦ç†ã¨ã—ã¦ã¾ã¨ã‚ã‚‹
Â  Â  buildRows(videosWithSongTags);
Â  Â  applyFilter(); // åˆæœŸè¡¨ç¤ºã¯ãŠæ°—ã«å…¥ã‚Šãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å«ã‚ã¦å®Ÿè¡Œ
Â  })
Â  .catch(err => {
Â  Â  console.error(err);
Â  Â  $empty.style.display='block';
Â  Â  $empty.textContent='videos.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚';
Â  });


Â Â 

$q.addEventListener('keydown', e=>{ if(e.key==='Enter') applyFilter(); });
$q.addEventListener('search', applyFilter);
$q.addEventListener('input', applyFilter);

Â  Â Â 

Â Â 
Â  Â  // ===== detawaneé¢¨ï¼šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã¨ãã ã‘ãƒ¢ãƒã‚¤ãƒ«ã§æµ®å‹•åŒ– =====
(function(){
Â  const mq = window.matchMedia('(max-width: 900px)');
Â  const headerH = 84;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ãƒ˜ãƒƒãƒ€ãƒ¼ã¨åŒã˜å€¤ã«åˆã‚ã›ã‚‹
Â  const $playerCol = document.querySelector('.player-col'); // ãƒ‘ãƒãƒ«ã®åˆ—å…¨ä½“

Â  // æµ®å‹•ON/OFF
Â  function setFloat(enable){
Â  Â  const canFloat = enable && $panel.style.display !== 'none';
Â  Â  document.body.classList.toggle('has-float', canFloat);
Â  Â  $panel.classList.toggle('is-float', canFloat);
Â  }

Â  // äº¤å·®ç›£è¦–ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒãƒ«ãŒã€Œååˆ†è¦‹ãˆã¦ã„ã‚‹ã‹ã€ã‚’ç›£è¦–
Â  let io = null;
Â  function attachObserver(){
Â  Â  if(io){ io.disconnect(); io = null; }
Â  Â  if(!mq.matches){ setFloat(false); return; } // PCã¯å¸¸ã«é€šå¸¸è¡¨ç¤º

Â  Â  // ä¸Šå´ã«å°‘ã—ä½™ç™½ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ï¼‰ã‚’ã¨ã£ã¦ã€è¦‹åˆ‡ã‚Œå§‹ã‚ãŸã‚‰æµ®å‹•åŒ–
Â  Â  io = new IntersectionObserver((entries)=>{
Â  Â  Â  for(const e of entries){
Â  Â  Â  Â  const visible = e.isIntersecting && e.intersectionRatio > 0.6; // 6å‰²è¦‹ãˆã¦ã„ã‚Œã°é€šå¸¸
Â  Â  Â  Â  setFloat(!visible); // è¦‹ãˆã«ãããªã£ãŸã‚‰æµ®å‹•ON
Â  Â  Â  }
Â  Â  }, { root: null, rootMargin: `-${headerH + 8}px 0px 0px 0px`, threshold: [0, 0.6, 1] });

Â  Â  // åˆ—å…¨ä½“ã‚’ç›£è¦–ï¼ˆstickyã‚„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰åŒ–ã§ã‚‚å®‰å®šï¼‰
Â  Â  io.observe($playerCol);
Â  }

Â  // ç”»é¢å¹…ã®åˆ‡æ›¿ãƒ»å‘ãå¤‰æ›´ãƒ»ãƒ­ãƒ¼ãƒ‰æ™‚ã«ç›£è¦–ã‚’ä»˜ã‘ç›´ã™
Â  mq.addEventListener('change', attachObserver);
Â  window.addEventListener('orientationchange', attachObserver);
Â  window.addEventListener('resize', attachObserver);
Â  window.addEventListener('load', attachObserver);

Â  // å‹•ç”»ã‚’é–‹ã„ãŸç›´å¾Œã«ã‚‚åˆ¤å®šï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒåˆã‚ã¦è¡¨ç¤ºã•ã‚ŒãŸã¨ãç”¨ï¼‰
Â  window.updateFloatOnPlay = function(){
Â  Â  attachObserver();Â  Â // å¿µã®ãŸã‚å†ã‚¢ã‚¿ãƒƒãƒ
Â  };
})();

Â  Â  // ===== ãƒ¢ãƒã‚¤ãƒ«æµ®å‹•ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¶å¾¡ =====
Â  Â  function updateFloatPlayer(){
Â  Â  if(window.innerWidth <= 900){
Â  Â  // ãƒ¢ãƒã‚¤ãƒ«æ™‚ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æµ®å‹•åŒ–
Â  Â  if($panel.style.display !== 'none'){
Â  Â  Â  document.body.classList.add('has-float');
Â  Â  Â  $panel.classList.add('is-float');
Â  Â  }
Â  Â  }else{
Â  Â  // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—æ™‚ï¼šé€šå¸¸è¡¨ç¤ºã«æˆ»ã™
Â  Â  document.body.classList.remove('has-float');
Â  Â  $panel.classList.remove('is-float');
}
}
window.addEventListener('resize', updateFloatPlayer);
window.addEventListener('orientationchange', updateFloatPlayer);
window.addEventListener('load', updateFloatPlayer);

// ===== æµ®å‹•ãƒ‘ãƒãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹• =====
(function(){
Â  const panel = document.getElementById('playerPanel');
Â  const headÂ  = panel?.querySelector('.player-head');
Â  if(!panel || !head) return;

Â  let dragging = false, startX=0, startY=0, startLeft=0, startTop=0;

Â  function px(n){ return `${Math.round(n)}px`; }

Â  function onDown(e){
Â  Â  if(!panel.classList.contains('is-float')) return;
Â  Â  dragging = true;
Â  Â  const rect = panel.getBoundingClientRect();
Â  Â  startLeft = rect.left; startTop = rect.top;
Â  Â  const p = (e.touches?.[0] || e);
Â  Â  startX = p.clientX; startY = p.clientY;

Â  Â  // ä½ç½®ã‚’ left/top ãƒ™ãƒ¼ã‚¹ã«åˆ‡æ›¿ï¼ˆåˆå›ã ã‘ï¼‰
Â  Â  panel.style.right = 'auto'; panel.style.bottom = 'auto';
Â  Â  panel.style.leftÂ  = px(startLeft);
Â  Â  panel.style.topÂ  Â = px(startTop);

Â  Â  document.addEventListener('mousemove', onMove);
Â  Â  document.addEventListener('touchmove', onMove, {passive:false});
Â  Â  document.addEventListener('mouseup', onUp);
Â  Â  document.addEventListener('touchend', onUp);
Â  }

Â  function onMove(e){
Â  Â  if(!dragging) return;
Â  Â  const p = (e.touches?.[0] || e);
Â  Â  const dx = p.clientX - startX;
Â  Â  const dy = p.clientY - startY;

Â  Â  // ç”»é¢å†…ã«åã‚ã‚‹ï¼ˆä½™ç™½8pxï¼‰
Â  Â  const vw = window.innerWidth, vh = window.innerHeight;
Â  Â  const rÂ  = panel.getBoundingClientRect();
Â  Â  let L = startLeft + dx, T = startTop + dy;
Â  Â  L = Math.min(vw - r.width - 8, Math.max(8, L));
Â  Â  T = Math.min(vh - r.height - 8, Math.max(8, T));

Â  Â  panel.style.left = px(L);
Â  Â  panel.style.topÂ  = px(T);
Â  Â  e.preventDefault?.();
Â  }

Â  function onUp(){
Â  Â  dragging = false;
Â  Â  document.removeEventListener('mousemove', onMove);
Â  Â  document.removeEventListener('touchmove', onMove);
Â  Â  document.removeEventListener('mouseup', onUp);
Â  Â  document.removeEventListener('touchend', onUp);
Â  }

Â  head.addEventListener('mousedown', onDown);
Â  head.addEventListener('touchstart', onDown, {passive:true});
})();
Â  Â document.addEventListener('DOMContentLoaded', () => {
Â  // URLã® ?q= ã‚’å–å¾—ï¼ˆindexã‹ã‚‰æ¥ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰
Â  const q = new URLSearchParams(location.search).get('q') || '';

Â  // song.html å´ã®æ¤œç´¢å…¥åŠ›ã‚’å–å¾—ï¼ˆ#q ãŒç„¡ã‘ã‚Œã° name="q" ã‚’æ¢ã™ï¼‰
Â  const $input =
Â  Â  document.querySelector('#q') ||
Â  Â  document.querySelector('input[name="q"]') ||
Â  Â  document.querySelector('input[type="search"]');

Â  if ($input && q) {
Â  Â  $input.value = q;
Â  Â  // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒèµ°ã‚‹å®Ÿè£…ãªã‚‰ç™ºç«
Â  Â  $input.dispatchEvent(new Event('input', { bubbles: true }));
Â  }

Â  // ä¸€è¦§ã‚’æç”»ã™ã‚‹é–¢æ•°ã‚’å‘¼ã¶ï¼ˆã‚ãªãŸã®å®Ÿè£…åã«åˆã‚ã›ã¦ï¼‰
Â  if (typeof apply === 'function') {
Â  Â  apply();
Â  } else if (typeof runSearch === 'function') {
Â  Â  runSearch(q);
Â  }
});
(function () {
Â  const params = new URLSearchParams(location.search);
Â  const initialQ = (params.get("q") || "").trim();

Â  // å…¥åŠ›æ¬„ã‚’è¦‹ã¤ã‘ã‚‹ï¼ˆid="#q" æ¨å¥¨ã€‚ç„¡ã„å ´åˆã®ä¿é™ºã‚‚ç”¨æ„ï¼‰
Â  const getInput = () =>
Â  Â  document.querySelector("#q") ||
Â  Â  document.querySelector('input[name="q"]') ||
Â  Â  document.querySelector('input[type="search"]');

Â  // ã‚ãªãŸã®å®Ÿè£…ã«åˆã‚ã›ã¦ã€Œæ¤œç´¢ã‚’èµ°ã‚‰ã›ã‚‹ã€é–¢æ•°å€™è£œã‚’åˆ—æŒ™
Â  function fireSearch(q) {
Â  Â  const $in = getInput();
Â  Â  if ($in) {
Â  Â  Â  if (q) $in.value = q;
Â  Â  Â  // inputã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ•ã‚£ãƒ«ã‚¿ãŒèµ°ã‚‹å®Ÿè£…ã¸ã®å¯¾å¿œ
Â  Â  Â  $in.dispatchEvent(new Event("input", { bubbles: true }));
Â  Â  Â  // form-submitå‹ã®å®Ÿè£…ã¸ã®å¯¾å¿œï¼ˆå¿…è¦ãªã‚‰æœ‰åŠ¹åŒ–ï¼‰
Â  Â  Â  // const form = $in.closest("form");
Â  Â  Â  // if (form && typeof form.requestSubmit === "function") form.requestSubmit();
Â  Â  }
Â  Â  // ç›´æ¥é–¢æ•°ã‚’å‘¼ã¶å®Ÿè£…ã¸ã®å¯¾å¿œï¼ˆã©ã‚Œã‹ãŒå­˜åœ¨ã™ã‚Œã°å‘¼ã¶ï¼‰
Â  Â  if (typeof apply === "function")Â  Â  Â  Â  apply();
Â  Â  if (typeof runSearch === "function")Â  Â  runSearch(q || ($in && $in.value) || "");
Â  Â  if (typeof render === "function")Â  Â  Â  Â render();
Â  }

Â  if (!initialQ) return; // ã‚¯ã‚¨ãƒªãŒç„¡ã„ã¨ãã¯ä½•ã‚‚ã—ãªã„

Â  // ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹: videos.jsonï¼‰ã‚„UIåˆæœŸåŒ–ã‚’å¾…ã£ã¦ã‹ã‚‰å®Ÿè¡Œ
Â  // 1) ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã§ ready ã‚’é£›ã°ã—ã¦ã„ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰
Â  window.addEventListener("app:ready", () => fireSearch(initialQ), { once: true });

Â  // 2) ä¿é™º: apply/runSearch ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆæœ€å¤§3ç§’ï¼‰
Â  const startedAt = performance.now();
Â  (function waitReady() {
Â  Â  const ready =
Â  Â  Â  typeof apply === "function" ||
Â  Â  Â  typeof runSearch === "function" ||
Â  Â  Â  typeof render === "function";
Â  Â  if (ready) return fireSearch(initialQ);
Â  Â  if (performance.now() - startedAt > 3000) return fireSearch(initialQ); // æœ€å¾Œã®æ‰‹æ®µ
Â  Â  requestAnimationFrame(waitReady);
Â  })();

Â  // URLã‚’ç¶ºéº—ã«ï¼ˆä»»æ„ï¼‰ï¼šåæ˜ å¾Œã¯ ?q= ã‚’æ¶ˆã—ã¦ãŠã
Â  window.addEventListener("load", () => {
Â  Â  try {
Â  Â  Â  const url = new URL(location.href);
Â  Â  Â  url.searchParams.delete("q");
Â  Â  Â  history.replaceState(null, "", url);
Â  Â  } catch (_) {}
Â  });
})();


Â  </script>
</body>
</html>
